// entry/src/main/ets/view/my/NavBar.ets
/**
 * â€œæˆ‘çš„â€ç•Œé¢é¡¶éƒ¨Navbarç»„ä»¶
 */
import router from '@ohos.router'
import promptAction from '@ohos.promptAction'
import { rvp } from '../../common/utils/DeviceScreen'
import { BarData } from '../../component/ScrollContainer'

@Component
export struct NavBar {
  @StorageProp('topRectHeight')
  topRectHeight: number = 0
  @Prop barData: BarData

  // âœ… å°çº¢ç‚¹ï¼šè¯»å–å…¨å±€â€œæ˜¯å¦æœ‰æœªè¯»æ¶ˆæ¯â€å¸ƒå°”å€¼
  @StorageLink('hasUnreadMessage')
  hasUnreadMessage: boolean = false

  build() {
    Row() {
      // å·¦ä¾§ä¸æ˜¾ç¤ºå†…å®¹ï¼Œä¿æŒå¸ƒå±€å¯¹ç§°
      Blank()

      // å³ä¾§ä¸‰ä¸ªå›¾æ ‡ï¼šå®¢æœ / æ¶ˆæ¯ / è®¾ç½®
      Row({ space: rvp(16) }) {

        // -------- å®¢æœï¼ˆæ— å°çº¢ç‚¹ï¼‰ --------
        Image($r('app.media.customer'))
          .width(rvp(20))
          .height(rvp(20))
          .fillColor(this.barData.fontColor)
          .onClick(() => {
            promptAction.showDialog({
              title: 'æç¤º',
              message: 'è¯¥æœåŠ¡æš‚æœªå¼€é€š',
            })
          })

        // -------- æ¶ˆæ¯ï¼ˆå¸¦å°çº¢ç‚¹ï¼‰--------
        Stack() {
          Image($r('app.media.message'))
            .width(rvp(20))
            .height(rvp(20))
            .fillColor(this.barData.fontColor)

          // ðŸ”´ å°çº¢ç‚¹ï¼šåªè¦ hasUnreadMessage ä¸º true å°±æ˜¾ç¤º
          if (this.hasUnreadMessage) {
            Column() { }
            .width(rvp(8))
            .height(rvp(8))
            .borderRadius(rvp(4))
            .backgroundColor('#FF3B30')
            .align(Alignment.TopEnd)
            .offset({ x: rvp(2), y: -rvp(2) })
          }
        }
        .onClick(() => {
          router.pushUrl({
            url: 'pages/ChatList'
          })
        })

        // -------- è®¾ç½® --------
        Image($r('app.media.setting'))
          .width(rvp(20))
          .height(rvp(20))
          .fillColor(this.barData.fontColor)
          .onClick(() => {
            router.pushUrl({
              url: 'view/my/Settings'
            })
          })
      }
    }
    .width('100%')
    .justifyContent(FlexAlign.SpaceBetween)
    .padding({
      left: rvp(8),
      right: rvp(8),
      top: this.topRectHeight + rvp(8),
      bottom: rvp(8)
    })
    .backgroundColor(this.barData.bgColor)
  }
}
