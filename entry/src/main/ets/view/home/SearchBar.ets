/**
 * é¡¶éƒ¨æœç´¢ç»„ä»¶
 */
import { BarData } from '../../component/ScrollContainer';
import { router } from '@kit.ArkUI';
import { rvp } from '../../common/utils/DeviceScreen';

@Component
export struct SearchBar {
  @StorageProp('topRectHeight')
  topRectHeight: number = 0

  @Prop barData: BarData

  // âœ… æ”¹è¿™é‡Œï¼šç»‘å®šå…¨å±€ â€œæ˜¯å¦æœ‰æœªè¯»æ¶ˆæ¯â€ çš„å¸ƒå°”å€¼
  @StorageLink('hasUnreadMessage')
  hasUnreadMessage: boolean = false

  build() {
    Row({ space: rvp(16) }) {
      // å·¦ä¾§ï¼šå½“å‰åŸå¸‚
      Text('åŒ—äº¬')
        .fontSize(14)
        .fontColor(this.barData.fontColor)

      // ä¸­é—´ï¼šæœç´¢æ¡† + å®šä½
      Stack() {
        TextInput()
          .placeholderFont({ size: 12 })
          .width('100%')
          .height(rvp(30))
          .backgroundColor(Color.White)
          .borderColor($r('app.color.gray'))
          .borderWidth(1)

        Row() {
          Image($r('app.media.search'))
            .width(rvp(18))
            .height(rvp(18))

          Text('å…¬å›­/åœ°é“')
            .fontSize(10)
            .fontColor($r('app.color.text_gray'))
            .layoutWeight(1)

          Column()
            .width(1)
            .height(rvp(18))
            .backgroundColor('#ffababab')
            .margin({ left: rvp(10), right: rvp(10) })

          Image($r('app.media.position'))
            .width(rvp(18))
            .height(rvp(18))
        }
        .width('100%')
        .padding({ left: rvp(16), right: rvp(16) })
      }
      .layoutWeight(1)
      .onClick(() => {
        router.pushUrl({
          url: 'pages/rentRoom/RoomList'
        })
      })

      // å³ä¾§ï¼šæ¶ˆæ¯æŒ‰é’®ï¼ˆå¸¦å°çº¢ç‚¹ï¼‰
      Stack() {
        // æ¶ˆæ¯å›¾æ ‡æœ¬ä½“
        Image($r('app.media.message'))
          .width(rvp(20))
          .height(rvp(20))
          .fillColor(this.barData.fontColor)

        // ğŸ”´ å°çº¢ç‚¹ï¼šåªçœ‹ hasUnreadMessageï¼Œä¸æ˜¾ç¤ºæ•°å­—
        if (this.hasUnreadMessage) {
          Column() { }
          .width(rvp(8))
          .height(rvp(8))
          .borderRadius(rvp(4))
          .backgroundColor('#FF3B30')
          .align(Alignment.TopEnd)
          .offset({ x: rvp(2), y: -rvp(2) })
        }
      }
      .onClick(() => {
        router.pushUrl({
          // è¿™é‡Œä¿æŒä½ åŸæ¥çš„æ¶ˆæ¯é¡µè·¯ç”±
          url: 'pages/ChatList'
        })
      })
    }
    .width('100%')
    .backgroundColor(this.barData.bgColor)
    .padding({
      left: rvp(16),
      right: rvp(16),
      top: rvp(4) + this.topRectHeight,
      bottom: rvp(6)
    })
  }
}
